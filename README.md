# orb-artifactory

CircleCI Orb created in partnership with jFrog.

## Features

This orb will support the major features of the [JFrog CLI](https://www.jfrog.com/confluence/display/CLI/CLI+for+JFrog+Artifactory)

To limit the permutations of variables, advanced use cases must pass a [`specs` file.](https://www.jfrog.com/confluence/display/CLI/CLI+for+JFrog+Artifactory#CLIforJFrogArtifactory-UsingFileSpecs)

### Jobs

You can reference the provided Jobs from a 2.1 Workflows configuration stanza. Unless provided, the executor is a OpenJDK 8 Docker image.

- Upload - installs and configures CLI before calling upload command.

#### Upload Job Example

Upload Job requires `source`, `target` and either `build-steps` or `workspace-path` for resolving artifacts to publish.  Optionally a [`file-spec`](https://www.jfrog.com/confluence/display/RTF/Using+File+Specs) may be passed to the CLI for additional options.
```
version: 2.1
workflows:
  version: 2
  publish:
    jobs:
      - artifactory/upload:
          name: Publish Maven Jar
          build-steps:
            - run: mvn install -B
          source: test/artifact.jar
          target: repo/path
```


### Commands
If you desire higher deeper access, you may use the following commands directly from your own job.

- Upload - upload assets using `source` and `target` arguments
- Install - install JFrog CLI if not present
- Configure - configure CLI to use `ARTIFACTORY_URL` and `ARTIFACTORY_API_KEY` for all interactions

#### Custom CLI Command Example
Install CLI and upload environment info.
```
version: 2.1
jobs:
  build:
    docker:
    - image: circleci/node:10
    working_directory: ~/repo
    steps:
    - checkout
    - artifactory/install
    - artifactory/configure
    - run:
        command: |
          jfrog rt bce my-build ${CIRCLE_BUILD_NUM}
```


## Contributing

### Orbs Authoring / Contributing
See https://github.com/CircleCI-Public/config-preview-sdk/blob/master/docs/getting-started.md


### Testing
Currently using BATS to test output generated by our orb.  
`bats tests/config_tests.bats`

#### Testing against published orb
An optional env var `$BATS_IMPORT_DEV_ORB` can reference the full path of a published orb to test resolution against.  See [config.yml](.circleci/config.yml) for example.

#### More on BATS
See [BATS project](https://github.com/bats-core/bats-core) for usage and more.
