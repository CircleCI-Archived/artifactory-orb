#given
workflows:
  version: 2
  test-orb:
    jobs:
      - artifactory/upload:
          name: Test Upload
          source: test/artifact.jar
          target: repo/path
          file-spec: spec.json
          pre-steps:
            - checkout
            - run: npm install
            - run: mvn package
            - attach_workspace:
                at: somepath
#end given



#then
version: 2.1
jobs:
  Test Upload:
    docker:
    - image: circleci/openjdk:8
    steps:
    - checkout
    - run:
        command: npm install
    - run:
        command: mvn package
    - attach_workspace:
        at: somepath
    - run:
        command: |-
          curl -fL https://getcli.jfrog.io | sh
          chmod a+x jfrog && sudo mv jfrog /usr/local/bin
        name: Install JFrog CLI
    - run:
        command: jfrog rt c rt-server-1 --url=${ARTIFACTORY_URL} --apikey=${ARTIFACTORY_API_KEY} --interactive=false
        name: Configure JFrog CLI
    - run:
        command: jfrog rt upload test/artifact.jar repo/path --spec=spec.json --build-name=${CIRCLE_PROJECT_REPONAME} --build-number=${CIRCLE_BUILD_NUM}
        name: Upload Assets with JFrog CLI
workflows:
  version: 2
  test-orb:
    jobs:
    - Test Upload
#end then

